<h1 class="text-center text-secondary mt-3 mb-3"><%= @recipe.name %></h1>

<div class="recipe_details_container">
  <div class="m-3 text-secondary">
    <span class="mt-3 mb-3">Preparation time:</span>
    <span class="mt-3 mb-3"><%= @recipe.preparation_time %></span><br>
    <span class="mt-3 mb-3">Cooking time:</span>
    <span class="mt-3 mb-3"><%= @recipe.cooking_time %></span><br>
    <span class="mt-3 mb-3">Step goes here:</span>
  </div>

  <div class="toggle-container m-3">
    <% if @recipe.user_id == current_user.id %>
      <%= form_with model: @recipe, url: toggle_recipe_path(@recipe), method: :patch, local: true do |form| %>
        <%= form.hidden_field :public, value: !@recipe.public %>
        <label class="switch">
          Public : 
          <div class="toggle_status_container">
            <input type="submit" class="btn-check toggle-button <%= @recipe.public ? 'private' : 'public' %>" id="btn-check-2-outlined" checked autocomplete="off">
            <label id="label" class="btn btn-outline-secondary" for="btn-check-2-outlined"><%= @recipe.public %></label><br>
          </div>
        </label>
      <% end %>
    <% end %>
  </div>
</div>

<div class="d-flex justify-content-between w-75 d-block mx-auto">
  <button class="btn btn-warning" id="gen">Generate shopping list</button>
  <% if current_user.id == @recipe.user_id %>
    <%= link_to "Add ingredient", new_recipe_food_path(@recipe), class: 'btn btn-primary' %>
  <% end %>
</div>

<div class="d-block mx-auto w-75">

<table class="table ">
  <thead>
    <tr>
      <th scope="col">Food</th>
      <th scope="col">Quantity</th>
      <th scope="col">Value</th>
      <th scope="col">Action</th>
    </tr>
  </thead>
  <tbody>
  <% @recipe_foods.each do |recipe_food| %>
    <tr>
      <td> <%= recipe_food.food.name %> </td>
      <td><%= recipe_food.quantity %></td>
      <td><%= recipe_food.quantity * recipe_food.food.price %></td>
      <td>
      <% if current_user.id == @recipe.user_id %>
        <%= form_with model: recipe_food.food, url: recipe_food_path(@recipe.id, recipe_food.food.id), method: :delete, local: false do |f| %>
          <%= f.hidden_field :food_id, value: "1" %>
          <%= f.submit "Delete", class: "btn btn-danger" %>
        <% end %>
      <% end %>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>

</div>
</div>

</div>

<div class="w-50 bg-light hauteur border border-1 position-absolute top-50 start-50 translate-middle ps-3" id="hide">
<span id="close-popup" class="close-icon float-right">&times;</span>
<h2 class="text-center text-secondary mb-3">Generating Shopping List</h2>
  <h5 class="mt-3 mb-3">Choose an inventory to use</h5>
  <%= form_with model: @recipe, url: shopping_lists_path, local: false do |f| %>
    <div class="input-group mb-3 w-75">
      <%= f.label :inventory_id, class: "input-group-text", for: "select-inventory" %>
      <%= f.select :inventory_id, @inventories.order(:name).map { |inventory| [inventory.name, inventory.id] }, {}, { class: "form-control", id: "select-inventory" } %>
    </div>
    <%= f.submit "Generate", class: "btn btn-dark", id: "generate-button" %>
  <% end %>  
    
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  let label = document.querySelector('#label');
  let btn = document.querySelector('#gen');
  let genBlock = document.querySelector('#hide');
  btn.addEventListener('click', () => {
    gen_block.style.display = 'block';
  })

</script>

